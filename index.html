<!DOCTYPE html>
<html lang="pt-BR" data-theme="light">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Tuboluc Classificador Premium</title>

    <!-- CSS -->
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="sidebar.css">
    <link rel="stylesheet" href="dashboard.css">
    <link rel="stylesheet" href="responsive.css">

    <!-- Fontes -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Use Font Awesome localmente para evitar bloqueios -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous">

    <!-- Chart.js - APENAS UMA VEZ -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>

</head>
<body>
    <!-- SIDEBAR -->
    <nav class="sidebar" role="navigation" aria-label="Menu principal">
        <div class="sidebar-header">
            <div class="logo">
                <div class="logo-icon" aria-hidden="true"></div>
                <div class="logo-text">
                    <h1>Tuboluc</h1>
                    <p>Classificador Premium</p>
                </div>
            </div>
            <button class="sidebar-toggle" id="sidebarToggle" aria-label="Alternar menu lateral">
                <i class="fas fa-bars" aria-hidden="true"></i>
            </button>
        </div>

        <div class="sidebar-menu">
            <!-- Seção Principal -->
            <div class="menu-section">
                <h3 class="menu-title">Principal</h3>
                <ul class="menu-list">
                    <li>
                        <a href="index.html" class="menu-item active" aria-current="page">
                            <i class="fas fa-chart-line" aria-hidden="true"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="produtos.html" class="menu-item">
                            <i class="fas fa-boxes" aria-hidden="true"></i>
                            <span>Produtos</span>
                            <span class="menu-badge" id="prodCountMenu">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="importar.html" class="menu-item">
                            <i class="fas fa-file-import" aria-hidden="true"></i>
                            <span>Importar</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Seção Análises -->
            <div class="menu-section">
                <h3 class="menu-title">Análises</h3>
                <ul class="menu-list">
                    <li>
                        <a href="relatorios.html" class="menu-item">
                            <i class="fas fa-chart-bar" aria-hidden="true"></i>
                            <span>Relatórios</span>
                        </a>
                    </li>
                    <li>
                        <a href="alertas.html" class="menu-item">
                            <i class="fas fa-bell" aria-hidden="true"></i>
                            <span>Alertas</span>
                            <span class="menu-badge badge-danger" id="alertCountMenu">0</span>
                        </a>
                    </li>
                    <li>
                        <a href="historico.html" class="menu-item">
                            <i class="fas fa-history" aria-hidden="true"></i>
                            <span>Histórico</span>
                        </a>
                    </li>
                </ul>
            </div>

            <!-- Seção Sistema -->
            <div class="menu-section">
                <h3 class="menu-title">Sistema</h3>
                <ul class="menu-list">
                    <li>
                        <a href="configuracoes.html" class="menu-item">
                            <i class="fas fa-cog" aria-hidden="true"></i>
                            <span>Configurações</span>
                        </a>
                    </li>
                    <li>
                        <a href="backup.html" class="menu-item">
                            <i class="fas fa-database" aria-hidden="true"></i>
                            <span>Backup</span>
                        </a>
                    </li>
                    <li>
                        <a href="ajuda.html" class="menu-item">
                            <i class="fas fa-question-circle" aria-hidden="true"></i>
                            <span>Ajuda</span>
                        </a>
                    </li>
                </ul>
            </div>
        </div>

        <div class="sidebar-footer">
            <div class="user-info">
                <div class="user-avatar" aria-hidden="true">
                    <i class="fas fa-user-circle"></i>
                </div>
                <div class="user-details">
                    <strong>Administrador</strong>
                    <small>admin@tuboluc.com</small>
                </div>
            </div>
            <button class="btn-logout" onclick="logout()" aria-label="Sair do sistema">
                <i class="fas fa-sign-out-alt" aria-hidden="true"></i>
            </button>
        </div>
    </nav>

    <!-- CONTEÚDO PRINCIPAL -->
    <main class="main-content">
        <!-- TOP BAR -->
        <header class="topbar">
            <div class="topbar-left">
                <div class="breadcrumb hide-sm">
                    <a href="index.html">Dashboard</a>
                </div>
                <h1 class="page-title">Visão Geral</h1>
            </div>
            <div class="topbar-right">
                <!-- Data e hora -->
                <div class="datetime hide-xs">
                    <i class="fas fa-calendar-alt" aria-hidden="true"></i>
                    <span id="currentDate">Carregando...</span>
                </div>
                <!-- Atalhos rápidos -->
                <div class="quick-actions">
                    <button class="btn-icon" onclick="window.location.href='importar.html'" aria-label="Importar dados">
                        <i class="fas fa-upload" aria-hidden="true"></i>
                    </button>
                    <button class="btn-icon" onclick="exportDashboard()" aria-label="Exportar dashboard">
                        <i class="fas fa-download" aria-hidden="true"></i>
                    </button>
                    <button class="btn-icon" onclick="toggleTheme()" aria-label="Alternar tema claro/escuro">
                        <i class="fas fa-moon" aria-hidden="true"></i>
                    </button>
                </div>
            </div>
        </header>

        <!-- CONTEÚDO DA PÁGINA -->
        <div class="page-content container p-responsive">
            <!-- KPIs Rápidos -->
            <div class="kpi-row dashboard-grid grid-responsive">
                <div class="kpi-card">
                    <div class="kpi-header">
                        <i class="fas fa-boxes" aria-hidden="true"></i>
                        <h3>Total de Produtos</h3>
                    </div>
                    <div class="kpi-body">
                        <div class="kpi-value" id="kpiTotal">0</div>
                        <div class="kpi-change positive text-responsive">
                            <i class="fas fa-arrow-up" aria-hidden="true"></i>
                            <span id="changeProdutos">0%</span>
                        </div>
                    </div>
                    <div class="kpi-footer">
                        <a href="produtos.html">Ver todos</a>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <i class="fas fa-dollar-sign" aria-hidden="true"></i>
                        <h3>Valor Total</h3>
                    </div>
                    <div class="kpi-body">
                        <div class="kpi-value" id="kpiTotalValue">R$ 0,00</div>
                        <div class="kpi-detail text-responsive">Em estoque</div>
                    </div>
                    <div class="kpi-footer">
                        <span id="mediaValorMedia">R$ 0,00</span>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <i class="fas fa-exclamation-triangle" aria-hidden="true"></i>
                        <h3>Produtos Críticos</h3>
                    </div>
                    <div class="kpi-body">
                        <div class="kpi-value" id="kpiCritical">0</div>
                        <div class="kpi-badge danger text-responsive">Atenção</div>
                    </div>
                    <div class="kpi-footer">
                        <a href="alertas.html">Ver alertas</a>
                    </div>
                </div>

                <div class="kpi-card">
                    <div class="kpi-header">
                        <i class="fas fa-tags" aria-hidden="true"></i>
                        <h3>Categorias</h3>
                    </div>
                    <div class="kpi-body">
                        <div class="kpi-value" id="kpiGroups">0</div>
                        <div class="kpi-detail text-responsive">Diversificadas</div>
                    </div>
                    <div class="kpi-footer">
                        <span id="categoriaPrincipal">Nenhuma</span>
                    </div>
                </div>
            </div>

            <!-- Gráficos -->
            <div class="charts-row dashboard-grid grid-responsive">
                <div class="chart-card">
                    <div class="chart-header flex-responsive">
                        <h3 class="card-title text-responsive">
                            <i class="fas fa-chart-pie" aria-hidden="true"></i>
                            Distribuição por Categoria
                        </h3>
                        <select
                            class="chart-filter"
                            id="distribuicaoFilter"
                            aria-label="Filtro de distribuição por categoria"
                        >
                            <option value="quantidade">Por Quantidade</option>
                            <option value="valor">Por Valor</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="chartDistribuicao"></canvas>
                    </div>
                </div>

                <div class="chart-card">
                    <div class="chart-header flex-responsive">
                        <h3 class="card-title text-responsive">
                            <i class="fas fa-chart-bar" aria-hidden="true"></i>
                            Top 10 Produtos
                        </h3>
                        <div class="chart-legend text-responsive" id="top10Legend"></div>
                    </div>
                    <div class="chart-container">
                        <canvas id="chartTop10"></canvas>
                    </div>
                </div>
            </div>

            <!-- Grade inferior: tabela + alertas -->
            <div class="dashboard-bottom">
                <!-- Tabela de produtos recentes -->
                <div class="card">
                    <div class="card-header flex-responsive">
                        <h3 class="card-title text-responsive">
                            <i class="fas fa-clock" aria-hidden="true"></i>
                            Atualizações Recentes
                        </h3>
                        <a href="produtos.html" class="btn-link">Ver todos</a>
                    </div>
                    <div class="table-responsive">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Produto</th>
                                    <th>Categoria</th>
                                    <th>Quantidade</th>
                                    <th>Valor Unit.</th>
                                    <th>Última Atualização</th>
                                    <th>Ações</th>
                                </tr>
                            </thead>
                            <tbody id="recentProducts">
                                <!-- Carregado via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Alertas rápidos -->
                <div class="card alert-card">
                    <div class="card-header flex-responsive">
                        <h3 class="card-title text-responsive">
                            <i class="fas fa-bell" aria-hidden="true"></i>
                            Alertas Prioritários
                        </h3>
                        <span class="badge badge-danger" id="alertCount">0</span>
                    </div>
                    <div class="alerts-list" id="priorityAlerts">
                        <div class="alert-item info">
                            <i class="fas fa-info-circle" aria-hidden="true"></i>
                            <div class="alert-content">
                                <strong>Bem-vindo ao Dashboard</strong>
                                <p class="text-responsive">Importe dados para começar a análise.</p>
                            </div>
                            <button
                                class="btn-icon"
                                onclick="window.location.href='importar.html'"
                                aria-label="Importar dados para começar a análise"
                            >
                                <i class="fas fa-arrow-right" aria-hidden="true"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- FOOTER -->
        <footer class="page-footer">
            <div class="footer-left text-responsive">
                <p>© 2024 Tuboluc Classificador Premium v2.1.0</p>
            </div>
            <div class="footer-right text-responsive">
                <span id="lastUpdate">Última atualização --</span>
                <span class="status-indicator online">
                    <i class="fas fa-circle" aria-hidden="true"></i>
                    Sistema online
                </span>
            </div>
        </footer>
    </main>

    <!-- SCRIPTS -->
    <script src="app.js" defer></script>
    <script src="dashboard.js" defer></script>
</body>
</html>